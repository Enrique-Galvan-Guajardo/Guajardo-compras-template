<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de productos</title>
    <!--Links to stylesheets-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./public/css/index.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Hind:300,400,500,600,700&display=swap">
    
    <!--Links to javascript files-->
    <!--Bootstrap 5-->
    <script src="./public/js/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/89ee7a970b.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="test">
        <div class="card text-center product-card">
            <div class="card-header">
                <p>Solicitud de pedido</p>
              <ul class="nav nav-tabs card-header-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="product-table-tab" data-toggle="tab" href="#product-table" role="tab" aria-controls="product-table" aria-selected="true">Añadir al pedido</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Estadística</a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item" id="most-asked-product-table-tab" data-toggle="tab" href="#most-asked-product-table" role="tab" aria-controls="most-asked-product-table" aria-selected="false">Más pedidos</a>
                      <a class="dropdown-item" id="less-asked-product-table-tab" data-toggle="tab" href="#less-asked-product-table" role="tab" aria-controls="less-asked-product-table" aria-selected="false">Menos pedidos</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" id="match-failed-product-table-tab" data-toggle="tab" href="#match-failed-product-table" role="tab" aria-controls="match-failed-product-table" aria-selected="false">Productos que más han fallado en match</a>
                    </div>
                  </li>
              </ul>
            </div>
            <div class="card-body tab-content">
                <div class="tab-pane fade show active" id="product-table" role="tabpanel" aria-labelledby="product-table-tab">
                    <h5 class="card-title">Lista de productos</h5>
                    <table id="order-table" class="table table-striped table-hover table-responsive">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col">#</th>
                            <th scope="col">Nombre</th>
                            <th class="hide-th" scope="col">Familia</th>
                            <th class="hide-th" scope="col">Sub Familia</th>
                            <th scope="col">Cantidad</th>
                            <th class="hide-th" scope="col">Presentación</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr id="product_item_1" class="row-item-added row-item">
                            <th scope="row">
                              <div>
                                <div>1</div>
                                <div class="product_item_tag">Añadido</div>
                              </div>
                            </th>
                            <td>
                                <div>
                                    <svg class="icon-xl2 tomate-hd"></svg>
                                </div>
                                <p>Tomate</p>
                            </td>
                            <td class="hide-td">Frutas y Verduras</td>
                            <td class="hide-td">Verduras</td>
                            <td class="row-item-count hide-input">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-info" type="button"><div>+</div></button>
                                </div>
                                <input id="product_item_1_count" type="number" class="form-control" placeholder="Ingresar cantidad" aria-label="Conjunto de botónes para producto" aria-describedby="Conjunto de botónes para cantidad de unidades" value="0">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-danger" type="button"><div>-</div></button>
                                </div>
                              </div>
                              <div class="my-2">
                                <div>x <span>0</span>&nbsp;<small class="text-muted">Cajas</small></div>
                                <svg class="icon-lg caja-hd"></svg>
                              </div>
                            </td>
                            <td class="hide-td">Caja</td>
                          </tr>
                          <tr id="product_item_2" class="row-item-added row-item">
                            <th scope="row"><div>1</div></th>
                            <td>
                                <div>
                                    <svg class="icon-xl2 pan-hd"></svg>
                                </div>
                                <p>Pan</p>
                            </td>
                            <td class="hide-td">Panadería</td>
                            <td class="hide-td">Pan de molde</td>
                            <td class="row-item-count hide-input">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-info" type="button"><div>+</div></button>
                                </div>
                                <input id="product_item_2_count" type="number" class="form-control" placeholder="Ingresar cantidad" aria-label="Conjunto de botónes para producto" aria-describedby="Conjunto de botónes para cantidad de unidades" value="0">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-danger" type="button"><div>-</div></button>
                                </div>
                              </div>
                              <div class="my-2">
                                <div>x <span>0</span>&nbsp;<small class="text-muted">Bolsas</small></div>
                                <svg class="icon-lg bolsa-hd"></svg>
                              </div>
                            </td>
                            <td class="hide-td">Bolsa</td>
                          </tr>
                          <tr id="product_item_3" class="row-item-added row-item">
                            <th scope="row"><div>1</div></th>
                            <td>
                                <div>
                                    <svg class="icon-xl2 carne-hd"></svg>
                                </div>
                                <p>Carne</p>
                            </td>
                            <td class="hide-td">Carnes</td>
                            <td class="hide-td">Carne roja</td>
                            <td class="row-item-count hide-input">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-info" type="button"><div>+</div></button>
                                </div>
                                <input id="product_item_3_count" type="number" class="form-control" placeholder="Ingresar cantidad" aria-label="Conjunto de botónes para producto" aria-describedby="Conjunto de botónes para cantidad de unidades" value="0">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-danger" type="button"><div>-</div></button>
                                </div>
                              </div>
                              <div class="my-2">
                                <div>x <span>0</span>&nbsp;<small class="text-muted">Kilogramos</small></div>
                                <svg class="icon-lg kilogramos-hd"></svg>
                              </div>
                            </td>
                            <td class="hide-td">Kilogramos</td>
                          </tr>
                          <tr id="product_item_4" class="row-item-added row-item">
                            <th scope="row"><div>1</div></th>
                            <td>
                                <div>
                                    <svg class="icon-xl2 galletas-hd"></svg>
                                </div>
                                <p>Galletas</p>
                            </td>
                            <td class="hide-td">Dulcería</td>
                            <td class="hide-td">Galletas</td>
                            <td class="row-item-count hide-input">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-info" type="button"><div>+</div></button>
                                </div>
                                <input id="product_item_4_count" type="number" class="form-control" placeholder="Ingresar cantidad" aria-label="Conjunto de botónes para producto" aria-describedby="Conjunto de botónes para cantidad de unidades" value="0">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-danger" type="button"><div>-</div></button>
                                </div>
                              </div>
                              <div class="my-2">
                                <div>x <span>0</span>&nbsp;<small class="text-muted">Paquetes</small></div>
                                <svg class="icon-lg paquete-hd"></svg>
                              </div>
                            </td>
                            <td class="hide-td">Paquete</td>
                          </tr>
                          <tr id="product_item_5" class="row-item-added row-item">
                            <th scope="row"><div>1</div></th>
                            <td>
                                <div>
                                    <svg class="icon-xl2 queso-hd"></svg>
                                </div>
                                <p>Queso</p>
                            </td>
                            <td class="hide-td">Lácteos</td>
                            <td class="hide-td">Quesos</td>
                            <td class="row-item-count hide-input">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-info" type="button"><div>+</div></button>
                                </div>
                                <input id="product_item_5_count" type="number" class="form-control" placeholder="Ingresar cantidad" aria-label="Conjunto de botónes para producto" aria-describedby="Conjunto de botónes para cantidad de unidades" value="0">
                                <div class="input-group-prepend">
                                  <button class="btn btn-outline-danger" type="button"><div>-</div></button>
                                </div>
                              </div>
                              <div class="my-2">
                                <div>x <span>0</span>&nbsp;<small class="text-muted">Piezas</small></div>
                                <svg class="icon-lg pieza-hd"></svg>
                              </div>
                            </td>
                            <td class="hide-td">Pieza</td>
                          </tr>
                        </tbody>
                      </table>
                </div>
                <div class="tab-pane fade" id="most-asked-product-table" role="tabpanel" aria-labelledby="most-asked-product-table-tab">
                    <h5 class="card-title">Más solicitados</h5>
                    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                    <a href="#" class="btn btn-primary">Go somewhere</a>
                </div>
                <div class="tab-pane fade" id="less-asked-product-table" role="tabpanel" aria-labelledby="less-asked-product-table-tab">
                    <h5 class="card-title">Menos solicitados</h5>
                    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                    <a href="#" class="btn btn-primary">Go somewhere</a>
                </div>
                <div class="tab-pane fade" id="match-failed-product-table" role="tabpanel" aria-labelledby="match-failed-product-table-tab">
                    <h5 class="card-title">Productos que más fallan en coincidencias</h5>
                    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                    <a href="#" class="btn btn-primary">Go somewhere</a>
                </div>
            </div>
          </div>
    </div>
    <script>
      // Obtener la lista UL
      const order_table = document.getElementById('order-table');

      // Obtener todos los elementos LI de la lista
      const items_tr = order_table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

      // Recorrer cada elemento LI y agregar el evento de clic
      for (let i = 0; i < items_tr.length; i++) {
        // Permite mostrar u ocultar los campos para añadir productos
        items_tr[i].getElementsByClassName('row-item-count')[0].children[1].addEventListener('click', function() {
          this.parentElement.classList.toggle('hide-input');
          this.parentElement.classList.toggle('show-input');
        });
        // Determinar el si el producto será catalogado con una etiqueta o no en caso de haber una cantidad solicitada
        function set_Product_Tag(element) {
          
        }
        // Determinar el objeto
        function det_Object(element) {
          let item_id = element.id
          let input_count = element.querySelector('#'+item_id+'_count')
          let tag_count = element.children[4].children[1].children[0].children[0]
          
          let row_object = [
            { id: item_id},
            { input_count: input_count },
            { tag_count: tag_count }
          ];
          
          return row_object;
        }
        // Permite VERIFICAR input productos
        function check_Product(element) {
          // Se confirma que el valor del elemento sea inferior a 0
          if (element[1].input_count.value < 0) {
            // En caso de ser un número negativo, se actualizará el input a 0, de esa manera bloquear el ingreso de números negativos al teclearlos
            element[1].input_count.value = parseInt(0);
            // Por consecuencia, la etiqueta también se actualizará a 0
            element[2].tag_count.innerHTML = parseInt(element[1].input_count.value);
          }else if (element[1].input_count.value === '') {
            // En caso de que se eliminen todos los números en el campo y quede vacío, se actualizará el input a 0
            element[1].input_count.value = parseInt(0);
            // Por consecuencia, la etiqueta también se actualizará a 0
            element[2].tag_count.innerHTML = parseInt(element[1].input_count.value);
          }else{
            // Por contrario, si el valor ingresado por teclado es mayor a 0, la etiqueta también se actualizará al valor del input
            element[2].tag_count.innerHTML = parseInt(element[1].input_count.value);
          }
        }
        // Permite SUMAR productos
        function sum_Product(element, update) {
          // Se verifica que el valor de update sea verdadero
          if (update){
            // Si es verdadero, significa que fue llamado desde el botón + y requiere sumarse el valor al input y actualizar la etiqueta
            element[1].input_count.value = parseInt(element[1].input_count.value) + 1;
            // Se actualiza la etiqueta con respecto al valor del input
            element[2].tag_count.innerHTML = element[1].input_count.value;
          }else{
            // Si es falso, significa que el valor se está ingresando por las teclas flecha ARRIBA, por lo cual el input se actualiza automáticamente y sólo resta actualizar la etiqueta
            element[2].tag_count.innerHTML = parseInt(element[1].input_count.value) + 1;
          }
        }
        // Permite ELIMINAR productos
        function del_Product(element, update) {
          // Se verifica que el valor dentro del input sea mayor a 0
          if (element[1].input_count.value > 0) {
            // Se verifica que el valor de update sea verdadero
            if (update){
              // Si es verdadero, significa que fue llamado desde el botón - y requiere restar el valor al input y actualizar la etiqueta
              element[1].input_count.value = parseInt(element[1].input_count.value) - 1;
              // Se actualiza la etiqueta con respecto al valor del input
              element[2].tag_count.innerHTML = element[1].input_count.value;
            }else{
              // Si es falso, significa que el valor se está ingresando por las teclas flecha ABAJO y flecha ABAJO, por lo cual el input se actualiza automáticamente y sólo resta actualizar la etiqueta
              element[2].tag_count.innerHTML = parseInt(element[1].input_count.value) - 1;
            }
          }else if (element[1].input_count.value == 0 && !update){
            // Si el valor del input es igual a 0 y el valor de update es falso, significa que se está intentando actualizar el input con flecha ABAJO hacia valores negativos, lo cual no está permitido, entonces siempre se sumará un 1 cuando intente llegar a -1 regresándolo a 0 causando un bloqueo a números negativos
            element[1].input_count.value = parseInt(element[1].input_count.value) + 1;
          }
        }
        // Agregar un evento al botón +
        items_tr[i].getElementsByClassName('row-item-count')[0].children[0].children[0].children[0].addEventListener('click', function() {
          // Función para crear un array del input
          let rowObject = det_Object(this.parentElement.parentElement.parentElement.parentElement);
          // Función para sumar dentro del input
          sum_Product(rowObject, true);
        });
        // Agregar un evento al botón -
        items_tr[i].getElementsByClassName('row-item-count')[0].children[0].children[2].children[0].addEventListener('click', function() {
          // Función para crear un array del input
          let rowObject = det_Object(this.parentElement.parentElement.parentElement.parentElement);
          // Función para restar dentro del input
          del_Product(rowObject, true);
        });
        // Agregar un evento keydown al input
        items_tr[i].getElementsByClassName('row-item-count')[0].children[0].children[1].addEventListener('keydown', function(event) {
          // Verificar si se presionó la tecla "Arriba" (código 38) o "Abajo" (código 40)
          if (event.keyCode === 38) { // Flecha "Arriba"
            // Función para crear un array del input
            let rowObject = det_Object(this.parentElement.parentElement.parentElement);
            // Función para sumar dentro del input
            sum_Product(rowObject, false);
          } else if (event.keyCode === 40) { // Flecha "Abajo"
            // Función para crear un array del input
            let rowObject = det_Object(this.parentElement.parentElement.parentElement);
            // Función para restar dentro del input
            del_Product(rowObject, false);          
          }
        });
        // Agregar un evento input al input
        items_tr[i].getElementsByClassName('row-item-count')[0].children[0].children[1].addEventListener('input', function() {
          // Función para crear un array del input
          let rowObject = det_Object(this.parentElement.parentElement.parentElement);
          // Función para verificar si se tecleó el número y cumple con no ser inferior a 0
          check_Product(rowObject);          
        });
      }
    </script>
</body>
</html>